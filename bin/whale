#!/usr/bin/env ruby
# whale

# 20061009
# 0.0.3

# Description: Sometimes when they go fishing, they get a whale and it sinks their boat.  

# History: 
# 1. I took #read_words_file from difflist.  
# 2. I took a bit of RandomMethod for #random_word.   

# Changes: 
# 1. It is mostly complete now.  It should read in the words file and submit one only counter_phish.  

# Todo: 
# 1. Iterate infinitely over the @words array and hammer the fuckers.  

require 'rubygems'
require 'mechanize'
require 'pp'

class Whale
  
  def initialize(url, form_name, username_field_name, password_field_name)
    @url, @form_name, @username_field_name, @password_field_name = url, form_name, username_field_name, password_field_name
    @words = read_words_file('/usr/share/dict/words')
    @words_size = @words.size # It is more efficient for this to be called once here.  
  end
  
  def counter_phish
    m = WWW::Mechanize.new
    page = m.get(@url)
    pp page  #debug
    
    form = page.form(@form_name)
    form.send(@username_field_name) = random_word
    form.send(@password_field_name) = random_word
    page = m.submit(form)
    pp page  #debug
  end
  
  private
  
  def read_words_file(filename)
    a = []
    File.open(filename, "r").each {|line| a << line.chomp }
    a
  end
  
  def random_word
    @words[rand(@words_size)]
  end
  
end

if __FILE__ == $0
  w = Whale.new(ARGV[0], ARGV[1], ARGV[2], ARGV[3])
  w.counter_phish
end
